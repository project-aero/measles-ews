outtmp <- tibble(
city = cities[i],
ews = j,
lag = 0:(lags-1),
correlations = rev(tmp_corrs)
)
out <- rbind(out, outtmp)
}
}
ggplot(out, aes(lag, correlations)) +
geom_line(aes(color = as.factor(ews))) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = "EWS") +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(rho))
ncities <- 4
cities <- c("Agadez", "Maradi", "Niamey", "Zinder")
news <- 10
ews <- c("Mean", "Variance", "CV", "ID", "Skew", "Kurt", "Acov", "AC", "Tau", "FDV")
lags <- 11
mean_rhos <- exp(seq(log(0.000001),log(0.9),length.out = lags))
out <- tibble()
for(i in 1:ncities){
for(j in 1:news){
tmp_corrs <- rnorm(lags, mean_rhos, mean_rhos*0.5)
tmp_corrs[tmp_corrs > 1] <- 1
tmp_corrs[tmp_corrs < 0] <- 0
outtmp <- tibble(
city = cities[i],
ews = ews[j],
lag = 0:(lags-1),
correlations = rev(tmp_corrs)
)
out <- rbind(out, outtmp)
}
}
ggplot(out, aes(lag, correlations)) +
geom_line(aes(color = as.factor(ews))) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = "EWS") +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(rho))
ggplot(out, aes(lag, correlations)) +
geom_line(aes(color = as.factor(ews))) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(rho))
ggplot(out, aes(as.factor(lag), correlations)) +
geom_line(aes(color = as.factor(ews))) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(rho))
ggplot(out, aes(as.character(lag), correlations)) +
geom_line(aes(color = as.factor(ews))) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(rho))
ggplot(out, aes(lag, correlations)) +
geom_line(aes(color = as.factor(ews))) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
scale_y_continuous(breaks = 0:10) +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(rho))
ggplot(out, aes(lag, correlations)) +
geom_line(aes(color = as.factor(ews))) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
scale_x_continuous(breaks = 0:10) +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(rho))
ncities <- 4
cities <- c("Agadez", "Maradi", "Niamey", "Zinder")
news <- 10
ews <- c("Mean", "Variance", "CV", "ID", "Skew", "Kurt", "Acov", "AC", "Tau", "FDV")
lags <- 11
mean_rhos <- (seq(sqrt(0.000001),sqrt(0.9),length.out = lags))^2
out <- tibble()
for(i in 1:ncities){
for(j in 1:news){
tmp_corrs <- rnorm(lags, mean_rhos, mean_rhos*0.5)
tmp_corrs[tmp_corrs > 1] <- 1
tmp_corrs[tmp_corrs < 0] <- 0
outtmp <- tibble(
city = cities[i],
ews = ews[j],
lag = 0:(lags-1),
correlations = rev(tmp_corrs)
)
out <- rbind(out, outtmp)
}
}
ggplot(out, aes(lag, correlations)) +
geom_line(aes(color = as.factor(ews))) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
scale_x_continuous(breaks = 0:10) +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(rho))
ncities <- 4
cities <- c("Agadez", "Maradi", "Niamey", "Zinder")
news <- 10
ews <- c("Mean", "Variance", "CV", "ID", "Skew", "Kurt", "Acov", "AC", "Tau", "FDV")
lags <- 11
mean_rhos <- (seq(sqrt(0.000001),sqrt(0.9),length.out = lags))^2
out <- tibble()
for(i in 1:ncities){
for(j in 1:news){
tmp_corrs <- rnorm(lags, mean_rhos, mean_rhos*0.2)
tmp_corrs[tmp_corrs > 1] <- 1
tmp_corrs[tmp_corrs < 0] <- 0
outtmp <- tibble(
city = cities[i],
ews = ews[j],
lag = 0:(lags-1),
correlations = rev(tmp_corrs)
)
out <- rbind(out, outtmp)
}
}
ggplot(out, aes(lag, correlations)) +
geom_line(aes(color = as.factor(ews))) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
scale_x_continuous(breaks = 0:10) +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(rho))
ncities <- 4
cities <- c("Agadez", "Maradi", "Niamey", "Zinder")
news <- 10
ews <- c("Mean", "Variance", "CV", "ID", "Skew", "Kurt", "Acov", "AC", "Tau", "FDV")
lags <- 11
mean_rhos <- (seq(sqrt(0.000001),sqrt(0.9),length.out = lags))^2
out <- tibble()
for(i in 1:ncities){
for(j in 1:news){
tmp_corrs <- rnorm(lags, mean_rhos, mean_rhos*0)
tmp_corrs[tmp_corrs > 1] <- 1
tmp_corrs[tmp_corrs < 0] <- 0
outtmp <- tibble(
city = cities[i],
ews = ews[j],
lag = 0:(lags-1),
correlations = rev(tmp_corrs)
)
out <- rbind(out, outtmp)
}
}
ggplot(out, aes(lag, correlations)) +
geom_line(aes(color = as.factor(ews))) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
scale_x_continuous(breaks = 0:10) +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(rho))
ncities <- 4
cities <- c("Agadez", "Maradi", "Niamey", "Zinder")
news <- 10
ews <- c("Mean", "Variance", "CV", "ID", "Skew", "Kurt", "Acov", "AC", "Tau", "FDV")
lags <- 11
mean_rhos <- (seq(sqrt(0.000001),sqrt(0.9),length.out = lags))^2
out <- tibble()
for(i in 1:ncities){
for(j in 1:news){
tmp_corrs <- rnorm(lags, mean_rhos, mean_rhos*0.2)
tmp_corrs[tmp_corrs > 1] <- 1
tmp_corrs[tmp_corrs < 0] <- 0
outtmp <- tibble(
city = cities[i],
ews = ews[j],
lag = 0:(lags-1),
correlations = rev(tmp_corrs)
)
out <- rbind(out, outtmp)
}
}
ggplot(out, aes(lag, correlations)) +
geom_line(aes(color = as.factor(ews))) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
scale_x_continuous(breaks = 0:10) +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(paste("Kendell's", tau)))
ggplot(out, aes(lag, correlations)) +
geom_point(aes(color = as.factor(ews))) +
stat_smooth(aes(color = as.factor(ews)), se = FALSE) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
scale_x_continuous(breaks = 0:10) +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(paste("Kendell's ", tau)))
out
ggplot(out, aes(x = lag, y = city, fill = correlations)) +
geom_polygon() +
facet_wrap(~as.factor(city), nrow = 1)
ggplot(out, aes(x = lag, y = city, fill = correlations)) +
geom_raster() +
facet_wrap(~as.factor(city), nrow = 1)
ggplot(out, aes(x = lag, y = ews, fill = correlations)) +
geom_raster() +
facet_wrap(~as.factor(city), nrow = 1)
ggplot(out, aes(x = lag, y = ews, fill = correlations)) +
geom_polygon() +
facet_wrap(~as.factor(city), nrow = 1)
ggplot(out, aes(x = lag, y = ews, fill = correlations)) +
geom_tile() +
facet_wrap(~as.factor(city), nrow = 1)
ggplot(out, aes(x = lag, y = ews, fill = correlations)) +
geom_tile() +
facet_wrap(~as.factor(city), nrow = 1) +
scale_fill_viridis()
library(viridis)
ggplot(out, aes(x = lag, y = ews, fill = correlations)) +
geom_tile() +
facet_wrap(~as.factor(city), nrow = 1) +
scale_fill_viridis()
ggplot(out, aes(x = lag, y = ews, fill = correlations)) +
geom_tile() +
facet_wrap(~as.factor(city), nrow = 1) +
scale_fill_viridis() +
scale_x_continuous(breaks = 0:10)
ggplot(out, aes(x = lag, y = ews, fill = correlations)) +
geom_tile() +
facet_wrap(~as.factor(city), nrow = 1) +
scale_fill_viridis(name = expression(paste("Kendell's ", tau))) +
scale_x_continuous(breaks = 0:10)
ggplot(out, aes(x = lag, y = ews, fill = correlations)) +
geom_tile() +
facet_wrap(~as.factor(city), nrow = 1) +
scale_fill_viridis(name = expression(paste("Kendell's ", tau)), limits = c(0,1)) +
scale_x_continuous(breaks = 0:10)
measles_data
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(ggthemes)
library(pomp)
library(lubridate)
theme_set(theme_minimal())
file_name <- "../niger_measles/niger_regional_1995_2005.csv"
niger_measles_raw <- read_csv(file_name, col_types = cols())
num_regions <- nrow(niger_measles_raw)
num_weeks <- ncol(niger_measles_raw) - 1  # subtract 1 from ncol() because first column are regions
weeks_per_year <- num_weeks/11
weeks <- rep(1:52, times = 11)
# Create a vector of years for all num_weeks
years <- rep(1995:2005, each = weeks_per_year)
# Function for calculating start of week based on week number and year
calculate_start_of_week = function(week, year) {
date <- ymd(paste(year, 1, 1, sep="-"))
week(date) = week
return(date)
}
# Clean up the data frame
measles_data <- niger_measles_raw %>%
gather(key = week, value = cases, -X1) %>%
mutate(
week_num = rep(1:num_weeks, each = num_regions),
year = rep(years, each  = num_regions),
week = rep(weeks, each = num_regions),
date = calculate_start_of_week(week, year)
) %>%
dplyr::rename(region = X1) %>%
filter(grepl("City", region))
ggplot(measles_data, aes(x = date, y = cases, color = region)) +
geom_path() +
facet_wrap(~region, scales = "free_y", nrow = 1) +
scale_color_manual(values = ptol_pal()(4)) +
guides(color = FALSE) +
ggtitle("Time series of data from 4 cities in Niger")
ncities <- 4
cities <- c("Agadez", "Maradi", "Niamey", "Zinder")
news <- 10
ews <- c("Mean", "Variance", "CV", "ID", "Skew", "Kurt", "Acov", "AC", "Tau", "FDV")
lags <- 11
mean_rhos <- (seq(sqrt(0.000001),sqrt(0.9),length.out = lags))^2
out <- tibble()
for(i in 1:ncities){
for(j in 1:news){
tmp_corrs <- rnorm(lags, mean_rhos, mean_rhos*0.2)
tmp_corrs[tmp_corrs > 1] <- 1
tmp_corrs[tmp_corrs < 0] <- 0
outtmp <- tibble(
city = cities[i],
ews = ews[j],
lag = 0:(lags-1),
correlations = rev(tmp_corrs)
)
out <- rbind(out, outtmp)
}
}
ggplot(out, aes(lag, correlations)) +
geom_point(aes(color = as.factor(ews))) +
stat_smooth(aes(color = as.factor(ews)), se = FALSE, size = 0.5) +
facet_wrap(~as.factor(city), nrow = 1) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
scale_x_continuous(breaks = 0:10) +
theme(legend.position = "top") +
labs(x = "Time lag (weeks)", y = expression(paste("Kendell's ", tau)))
library(viridis)
ggplot(out, aes(x = lag, y = ews, fill = correlations)) +
geom_tile() +
facet_wrap(~as.factor(city), nrow = 1) +
scale_fill_viridis(name = expression(paste("Kendell's ", tau)), limits = c(0,1)) +
scale_x_continuous(breaks = 0:10) +
labs(x = "Time lag (weeks)", y = "Early warning signal")
measles_data
scale_it <- function(x){
(x - min(x)) / (max(x) - min(x))
}
mode_data <- measles_data %>%
group_by(region) %>%
mutate(scaled_cases = scale_it(cases))
mode_data
mode_data <- measles_data %>%
group_by(region) %>%
mutate(scaled_cases = scale_it(cases+0.01))
mode_data
mode_data <- measles_data %>%
group_by(region) %>%
mutate(scaled_cases = scale_it(cases)*10)
mode_data
mode_data <- measles_data %>%
group_by(region) %>%
mutate(scaled_cases = scale_it(cases)*10 + 0.2)
mode_data
hist(mode_data$scaled_cases)
hist(mode_data$cases)
ews
ntimes <- 200
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ews = rep(ews, each = ntimes*4)
)
plotit
ntimes <- 20
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ews = rep(ews, each = ntimes*4)
)
ntimes <- 20
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ews = rep(ews, each = ntimes*4)
)
plotit
rep(c("above", "below"), each = 10)
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ews = rep(ews, each = ntimes*4),
rnaught = rep( rep(c("above", "below"), each = 10), times = ntimes*4)
)
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ews = rep(ews, each = ntimes*4),
rnaught = rep( rep(c("above", "below"), each = 10), times = 4*length(ews))
)
4*length(ews)
40*20
rep( rep(c("above", "below"), each = 10), times = 4*length(ews))
20*4
length(ews)
10*20*4
ntimes*length(ews)
200*4
ntimes <- 20
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ews = rep(ews, each = ntimes*4),
rnaught = rep( rep(c("above", "below"), each = 10), times = 4*length(ews))
)
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ewss = rep(ews, each = ntimes*4),
rnaught = rep( rep(c("above", "below"), each = 10), times = 4*length(ewss))
)
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ewss = rep(ews, each = ntimes*4),
rnaught = rep( rep(c("above", "below"), each = 10), times = 4*length(ews))
)
plotit
ntimes <- 20
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ewss = rep(ews, each = ntimes*4),
rnaught = rep( rep(c("above", "below"), each = 10), times = 4*length(ews))
) %>%
mutate(
correlations = ifelse(rnaught == "above", rnorm(1, 0.8, 0.1), rnorm(1, 0.2, 0.1))
)
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot()
plotit
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ewss = rep(ews, each = ntimes*4),
rnaught = rep( rep(c("above", "below"), each = 10), times = 4*length(ews))
) %>%
group_by(city, ews) %>%
mutate(
correlations = ifelse(rnaught == "above", rnorm(1, 0.8, 0.1), rnorm(1, 0.2, 0.1))
)
ntimes <- 20
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ewss = rep(ews, each = ntimes*4),
rnaught = rep( rep(c("above", "below"), each = 10), times = 4*length(ews))
) %>%
group_by(city, ewss) %>%
mutate(
correlations = ifelse(rnaught == "above", rnorm(1, 0.8, 0.1), rnorm(1, 0.2, 0.1))
)
plotit
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ewss = rep(ews, each = ntimes*4),
rnaught = rep( rep(c("above", "below"), each = 10), times = 4*length(ews))
) %>%
group_by(city, ewss) %>%
mutate(
correlations = ifelse(rnaught == "above", rnorm(ntimes*length(ews), 0.8, 0.1), rnorm(ntimes*length(ews), 0.2, 0.1))
)
plotit
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot() +
facet_wrap(~city)
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot(aes(fill = ewss)) +
facet_wrap(~city)
rep(ews, each = ntimes*4)
ntimes <- 20
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ewss = rep(ews, times = ntimes*4),
rnaught = rep( rep(c("above", "below"), each = 10), times = 4*length(ews))
) %>%
group_by(city, ewss) %>%
mutate(
correlations = ifelse(rnaught == "above", rnorm(ntimes*length(ews), 0.8, 0.1), rnorm(ntimes*length(ews), 0.2, 0.1))
)
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot(aes(fill = ewss)) +
facet_wrap(~city)
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot(aes(fill = ewss)) +
facet_wrap(~city) +
scale_color_manual(values = ptol_pal()(10), name = NULL) +
theme(legend.position = "top")
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot(aes(fill = ewss)) +
facet_wrap(~city) +
scale_fill_manual(values = ptol_pal()(10), name = NULL) +
theme(legend.position = "top")
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot(aes(fill = ewss)) +
facet_wrap(~city, nrow = 1) +
scale_fill_manual(values = ptol_pal()(10), name = NULL) +
theme(legend.position = "top")
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot(aes(fill = ewss)) +
facet_wrap(~city, nrow = 1) +
scale_fill_manual(values = ptol_pal()(10), name = NULL) +
theme(legend.position = "top") +
labs(x = expression(R[E]), y = expression(paste("Kendell's ", tau)))
ntimes <- 20
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ewss = rep(ews, times = ntimes*4),
rnaught = rep( rep(c("> 1", "< 1"), each = 10), times = 4*length(ews))
) %>%
group_by(city, ewss) %>%
mutate(
correlations = ifelse(rnaught == "above", rnorm(ntimes*length(ews), 0.8, 0.1), rnorm(ntimes*length(ews), 0.2, 0.1))
)
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot(aes(fill = ewss)) +
facet_wrap(~city, nrow = 1) +
scale_fill_manual(values = ptol_pal()(10), name = NULL) +
theme(legend.position = "top") +
labs(x = expression(R[E]), y = expression(paste("Kendell's ", tau)))
ntimes <- 20
plotit <- tibble(
city = rep(unique(measles_data$region), each = ntimes*length(ews)),
ewss = rep(ews, times = ntimes*4),
rnaught = rep( rep(c("> 1", "< 1"), each = 10), times = 4*length(ews))
) %>%
group_by(city, ewss) %>%
mutate(
correlations = ifelse(rnaught == "> 1", rnorm(ntimes*length(ews), 0.8, 0.1), rnorm(ntimes*length(ews), 0.2, 0.1))
)
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot(aes(fill = ewss)) +
facet_wrap(~city, nrow = 1) +
scale_fill_manual(values = ptol_pal()(10), name = NULL) +
theme(legend.position = "top") +
labs(x = expression(R[E]), y = expression(paste("Kendell's ", tau)))
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot(aes(fill = ewss)) +
facet_wrap(~city, nrow = 1, scales = "free_y") +
scale_fill_manual(values = ptol_pal()(10), name = NULL) +
theme(legend.position = "top") +
labs(x = expression(R[E]), y = expression(paste("Kendell's ", tau)))
ggplot(plotit, aes(x = rnaught, y = correlations)) +
geom_boxplot(aes(fill = ewss)) +
facet_wrap(~city, nrow = 1, scales = "free_y") +
scale_fill_manual(values = ptol_pal()(10), name = NULL) +
scale_y_continuous(limits = c(-0.1, 1)) +
theme(legend.position = "top") +
labs(x = expression(R[E]), y = expression(paste("Kendell's ", tau)))
